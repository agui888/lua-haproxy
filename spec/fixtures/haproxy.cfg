global
  stats socket /tmp/haproxy.sock mode 660 level admin
  stats timeout 30s
  lua-load build/lua-haproxy-api-latest.lua

defaults
  log  global
  mode  http
  timeout connect 5000
  timeout client  50000
  timeout server  50000

frontend http
  bind *:8000

  http-request lua.acl.logger

  acl uses_delete   method DELETE
  acl uses_get      method GET
  acl uses_head     method HEAD
  acl uses_options  method OPTIONS
  acl uses_patch    method PATCH
  acl uses_post     method POST
  acl uses_put      method PUT
  acl is_test       req.hdr(X-Test) -m found
  acl is_api        path            -m beg /api

  use_backend api if is_api
  default_backend httpbin

backend api
  http-request set-path %[path,regsub(/api,)]
  http-request use-service lua.haproxy-api

backend httpbin
  http-request set-header Host httpbin.org
  server httpbin.org 23.22.14.18:80
